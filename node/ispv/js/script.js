$(function () {

	$('.product').height($(window).height());
	var product = [];
	   product.push($(".center-frame #product1").ThreeSixty({
        totalFrames: 90, // Общее число кадров
        endFrame: 90, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item1/', // путь к папке с изображениями
        filePrefix: 'itemY1_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product2").ThreeSixty({
        totalFrames: 84, // Общее число кадров
        endFrame: 84, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item2/', // путь к папке с изображениями
        filePrefix: 'itemY2_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product3").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item4/', // путь к папке с изображениями
        filePrefix: 'itemY4_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product4").ThreeSixty({
        totalFrames: 87, // Общее число кадров
        endFrame: 87, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item5/', // путь к папке с изображениями
        filePrefix: 'itemY5_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product5").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item6/', // путь к папке с изображениями
        filePrefix: 'itemY6_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product6").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item7/', // путь к папке с изображениями
        filePrefix: 'itemY7_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product7").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item8/', // путь к папке с изображениями
        filePrefix: 'itemY8_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product8").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item9/', // путь к папке с изображениями
        filePrefix: 'itemY9_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product9").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item10/', // путь к папке с изображениями
        filePrefix: 'itemY10_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product10").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item11/', // путь к папке с изображениями
        filePrefix: 'itemY11_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product11").ThreeSixty({
        totalFrames: 87, // Общее число кадров
        endFrame: 87, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item12/', // путь к папке с изображениями
        filePrefix: 'itemY12_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product12").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item13/', // путь к папке с изображениями
        filePrefix: 'itemY13_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product13").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item14/', // путь к папке с изображениями
        filePrefix: 'itemY14_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product14").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item15/', // путь к папке с изображениями
        filePrefix: 'itemY15_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product15").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item16/', // путь к папке с изображениями
        filePrefix: 'itemY16_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
    product.push($(".center-frame #product16").ThreeSixty({
        totalFrames: 88, // Общее число кадров
        endFrame: 88, // конечный кадр
        currentFrame: 1, // с какого кадра стартовать
        progress: '.spinner',
        imgList: '.imgArray', // селектор изображений
        imagePath:'images/item17/', // путь к папке с изображениями
        filePrefix: 'itemY17_', // префикс файлов
        ext: '.jpg', // формат изображения
        autoplayDirection:-1,
        navigation: true
    }));
   
    active=0;
    product[active].play();
    timer=null;
    $(".center-frame").mousedown(function() {
      product[active].stop();
      if(timer!=null) clearInterval(timer);
      timer=setInterval(play360,30000);
    });
    $(".center-frame").on("touchstart",function() {
      product[active].stop();
      if(timer!=null) clearInterval(timer);
      timer=setInterval(play360,30000);
    });
    $('.previewi').click(function(){
      console.log(active+'!='+$(this).attr('data-product'));
    	if(active!=$(this).attr('data-product')){
	    	$('#product'+(active+1)).css('display','none');
	    	product[active].stop();

	    	active=parseInt($(this).attr('data-product'));
	    	product[active].play();
	    	$('#product'+(active+1)).css('display','table');
    	}
    });
	function play360()
	{
		product[active].play();
		 if(timer!=null) clearInterval(timer);
	}

    $('img[usemap]').rwdImageMaps();
    $('#rotateImg').css('top','-'+(($('#rotateImg').height()-$(window).height())/2)+'px');
    mapDrag=false;
    var startMapY;
    var endMapY;
    var lastMapY;
    var mapAngle=0;
    var startMapTime;
    var endMapTime;
    var rotatiFlag=false;
    var timi=0;
    var startObject;
    $('area, #mapimg').mousedown(function(e){
      rotatiFlag=false;
      if(!rotatiFlag) {
        mapDrag=true;
        startObject=$(this);
        startMapY=e.pageY;
        lastMapY=e.pageY;
        startMapTime=Date.now();
      }
      timi=new Date();
    })
    $('area, #mapimg').on("touchstart", function(e){
      rotatiFlag=false;
      if(!rotatiFlag) {
        console.log('touchstart');
        mapDrag=true;
        startMapY=e.originalEvent.changedTouches[0].pageY;
        lastMapY=e.originalEvent.changedTouches[0].pageY;
        startMapTime=Date.now();
      }
      timi=new Date();
    });
    $('area, #mapimg').mousemove(function(e){
      if(mapDrag){
        console.log('move '+mapAngle);
        mapAngle+=(lastMapY-e.pageY)/10;
        $('#mapimg').rotate(mapAngle);
        lastMapY=e.pageY;
      };
    })
    $('area, #mapimg').on("touchmove", function(e){
      if(mapDrag){

        console.log('touchmove');
        
        mapAngle+=(lastMapY-e.originalEvent.changedTouches[0].pageY)/10;
        $('#mapimg').rotate(mapAngle);
        lastMapY=e.originalEvent.changedTouches[0].pageY;
      };
    });
    $('area, #mapimg').mouseup(function(e){
      if(mapDrag){
        console.log('moup ');
        mapDrag=false;
        endMapY=e.pageY;
        endMapTime=Date.now();
       // console.log('pixels=' + (startMapY-endMapY) + ' time=' + (endMapTime-startMapTime) + ' dAngle' + (startMapY-endMapY)/(endMapTime-startMapTime));
        speed=1*(startMapY-endMapY)/(endMapTime-startMapTime);
        rotatiFlag=true;

        rotati(speed,(-1)*Math.sign(speed)*Math.abs(speed/30));
      }
    })
    $('area, #mapimg').on("touchend", function(e){

      if(mapDrag){
        console.log('touchend');
        mapDrag=false;
        endMapY=e.originalEvent.changedTouches[0].pageY;
        endMapTime=Date.now();
       // console.log('pixels=' + (startMapY-endMapY) + ' time=' + (endMapTime-startMapTime) + ' dAngle' + (startMapY-endMapY)/(endMapTime-startMapTime));
        speed=1*(startMapY-endMapY)/(endMapTime-startMapTime);
        rotatiFlag=true;

        rotati(speed,(-1)*Math.sign(speed)*Math.abs(speed/30));
      }
      if(startObject==$(this)) {
        //$(this).click();
      }
    });
    var timerId;
    function rotati(speed, a){
      if(timerId!=null) clearTimeout(timerId);
      if(rotatiFlag){
        //console.log(speed+' a='+a);
        if(Math.abs(speed)>=Math.abs(a)){
          //console.log(mapAngle + ' ' + (speed/1.5));
          mapAngle+=speed;

          $('#mapimg').rotate(mapAngle);
          timerId=setTimeout(function(){rotati(speed+a,a)},5);
        }else{
          mapAngle+=speed;
          $('#mapimg').rotate(mapAngle);

          rotatiFlag=false;
        }
      }
    }
    document.getElementById('mapimg').ondragstart = function(){return false;};
});
